# Prices Parser

Spring Boot приложение для парсинга информации о товарах (название, цена, описание) с веб-страниц и сохранения результатов в базу данных.

## Возможности

- Асинхронный парсинг веб-страниц с использованием Jsoup
- RESTful API для управления задачами парсинга и получения результатов
- In-memory база данных H2 с веб-консолью для просмотра
- Многопоточность с настраиваемым пулом потоков
- Фильтрация, сортировка и пагинация товаров

## Требования

- Java 21
- Maven 3.6+

## Установка и запуск

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd prices-parser
```

2. Соберите приложение:
```bash
mvn clean install
```

3. Запустите приложение:
```bash
mvn spring-boot:run
```

Или запустите скомпилированный JAR:
```bash
java -jar target/prices-parser-1.0.0.jar
```

Приложение запустится по адресу `http://localhost:8080`

## API эндпоинты

### Парсинг товаров

Запуск парсинга товаров по переданным URL:

**POST** `/api/parse`

Тело запроса:
```json
{
  "urls": [
    "https://example.com/product1",
    "https://example.com/product2"
  ]
}
```

Ответ: `202 Accepted` - парсинг запущен асинхронно

### Получение результатов парсинга

Получение спарсенных товаров с пагинацией и сортировкой:

**GET** `/api/results`

Параметры запроса:
- `page` - номер страницы (по умолчанию: 0)
- `size` - количество элементов на странице (по умолчанию: 10)
- `sortBy` - поле для сортировки (по умолчанию: "id")
- `sortDir` - направление сортировки: "asc" или "desc" (по умолчанию: "asc")

Пример:
```bash
curl "http://localhost:8080/api/results?page=0&size=20&sortBy=price&sortDir=desc"
```

Пример ответа:
```json
{
  "content": [
    {
      "id": 1,
      "url": "https://example.com/product",
      "title": "Название товара",
      "price": 99.99,
      "description": "Описание товара",
      "parsedAt": "2025-11-23T10:30:00"
    }
  ],
  "totalElements": 100,
  "totalPages": 5,
  "size": 20,
  "number": 0
}
```

### Получение товаров с фильтрами

**GET** `/api/products`

Параметры запроса:
- `page` - номер страницы
- `size` - количество элементов на странице
- `sortBy` - поле для сортировки
- `sortDir` - направление сортировки
- `minPrice` - минимальная цена (фильтр)
- `maxPrice` - максимальная цена (фильтр)
- `titleFilter` - поиск по названию

Пример:
```bash
curl "http://localhost:8080/api/products?minPrice=50&maxPrice=200&titleFilter=phone"
```

### Получение количества товаров

**GET** `/api/products/count`

Возвращает общее количество товаров в базе данных.

### Получение дорогих товаров

**GET** `/api/products/expensive?threshold=100`

Возвращает товары с ценой выше указанного порога.

### Получение товаров, отсортированных по цене

**GET** `/api/products/sorted-by-price`

Возвращает все товары, отсортированные по цене по убыванию.

## Доступ к базе данных

Приложение использует in-memory базу данных H2. Вы можете получить доступ к консоли базы данных через браузер:

**URL:** `http://localhost:8080/h2-console`

**Параметры подключения:**
- JDBC URL: `jdbc:h2:mem:pricesdb`
- Username: `sa`
- Password: *(оставьте пустым)*

Нажмите "Connect" для доступа к базе данных и выполнения SQL-запросов прямо в браузере.

## Конфигурация

Настройки приложения можно изменить в файле `src/main/resources/application.properties`:

- Порт сервера: `server.port=8080`
- Размер пула потоков: `parser.thread-pool.core-size=5`
- Настройки базы данных: конфигурация H2
- Уровни логирования

## Структура проекта

```
src/main/java/com/pricesparser/
├── client/          # HTTP клиенты для внешних запросов
├── config/          # Классы конфигурации Spring
├── controller/      # REST API контроллеры
├── dto/             # Объекты передачи данных
├── model/           # JPA сущности
├── parser/          # Логика парсинга веб-страниц
├── queue/           # Управление очередью URL
├── repository/      # JPA репозитории
├── service/         # Бизнес-логика сервисов
├── task/            # Определения асинхронных задач
└── util/            # Утилитарные классы
```

## Тестирование

Запуск тестов:
```bash
mvn test
```

## Технологии

- Spring Boot 3.2.0
- Spring Data JPA
- Spring WebFlux
- H2 Database
- Jsoup (HTML parser)
- OpenFeign
- Maven
